import{h as E,a as U,i as V,k as w,N as T,j as e,l as x,C as r,m,n as o,w as k,b as c,c as M,O as G,x as b,P as u,Q as f,U as C,V as j,B as P,W as S}from"./index-DClCG_Fx.js";function B(){const{user:d,getToken:h,refreshAuthToken:D}=E(),{toast:N}=U(),K=V(),{data:t,isLoading:y}=w({queryKey:["/api/admin/monthly-token-grant/status"],enabled:!!d&&d.role==="admin"}),l=T({mutationFn:async()=>{let n=h();if(!n)throw new Error("No authentication token found");const a=await fetch("/api/admin/monthly-token-grant",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(a.status===401)if(await D()){n=h();const i=await fetch("/api/admin/monthly-token-grant",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!i.ok){const A=await i.json();throw new Error(A.message||"Failed to grant tokens after refresh")}return i.json()}else throw new Error("Authentication failed. Please log in again.");if(!a.ok){const p=await a.json();throw new Error(p.message||"Failed to grant tokens")}return a.json()},onSuccess:()=>{K.invalidateQueries({queryKey:["/api/admin/monthly-token-grant/status"]}),N({title:"Success",description:"Monthly tokens granted successfully!"})},onError:n=>{N({title:"Error",description:n.message||"Failed to grant monthly tokens",variant:"destructive"})}}),v=()=>{window.confirm("Are you sure you want to grant monthly tokens to all active finders? This action cannot be undone.")&&l.mutate()},g=new Date().getDate()===1,s=(t==null?void 0:t.hasGrantedThisMonth)||!1;return y?e.jsxDEV("div",{className:"min-h-screen bg-gray-50",children:[e.jsxDEV(x,{currentPage:"monthly-tokens"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:105,columnNumber:9},this),e.jsxDEV("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-finder-red mx-auto"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:108,columnNumber:13},this),e.jsxDEV("p",{className:"text-gray-600 mt-4",children:"Loading monthly token status..."},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:109,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:107,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:106,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:104,columnNumber:7},this):e.jsxDEV("div",{className:"min-h-screen bg-gray-50",children:[e.jsxDEV(x,{currentPage:"monthly-tokens"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:118,columnNumber:7},this),e.jsxDEV("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxDEV("div",{className:"mb-8",children:[e.jsxDEV("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Monthly Token Grant"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:122,columnNumber:11},this),e.jsxDEV("p",{className:"text-gray-600 mt-2",children:"Manage automatic monthly token distribution to finders"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:123,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:121,columnNumber:9},this),e.jsxDEV(r,{className:"mb-6",children:[e.jsxDEV(m,{children:e.jsxDEV(o,{className:"flex items-center space-x-2",children:[e.jsxDEV(k,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:130,columnNumber:15},this),e.jsxDEV("span",{children:"Current Status"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:131,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:129,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:128,columnNumber:11},this),e.jsxDEV(c,{children:e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxDEV("div",{className:"flex items-center space-x-3",children:[s?e.jsxDEV(M,{className:"w-5 h-5 text-green-600"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:139,columnNumber:21},this):e.jsxDEV(G,{className:"w-5 h-5 text-blue-600"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:141,columnNumber:21},this),e.jsxDEV("div",{children:[e.jsxDEV("p",{className:"font-medium",children:"Monthly Token Grant Status"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:144,columnNumber:21},this),e.jsxDEV("p",{className:"text-sm text-gray-600",children:s?"Tokens have been granted this month":"Tokens not yet granted this month"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:145,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:143,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:137,columnNumber:17},this),e.jsxDEV(b,{variant:s?"default":"secondary",children:s?"Granted":"Pending"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:150,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:136,columnNumber:15},this),e.jsxDEV("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV(k,{className:"w-5 h-5 text-purple-600"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:157,columnNumber:19},this),e.jsxDEV("div",{children:[e.jsxDEV("p",{className:"font-medium",children:"Current Date"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:159,columnNumber:21},this),e.jsxDEV("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString()},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:160,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:158,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:156,columnNumber:17},this),e.jsxDEV(b,{variant:g?"default":"outline",children:g?"1st Day":"Not 1st Day"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:163,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:155,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:135,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:134,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:127,columnNumber:9},this),e.jsxDEV(r,{className:"mb-6",children:[e.jsxDEV(m,{children:e.jsxDEV(o,{className:"flex items-center space-x-2",children:[e.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:175,columnNumber:15},this),e.jsxDEV("span",{children:"Token Grant Details"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:176,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:174,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:173,columnNumber:11},this),e.jsxDEV(c,{children:e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV(f,{children:[e.jsxDEV(C,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:182,columnNumber:17},this),e.jsxDEV(j,{children:"This system automatically grants tokens to all active finders based on their level on the 1st day of each month."},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:183,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:181,columnNumber:15},this),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxDEV("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxDEV("h3",{className:"font-medium mb-2",children:"Monthly Token Amounts by Level"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:190,columnNumber:19},this),e.jsxDEV("ul",{className:"space-y-1 text-sm",children:[e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"GrandMeister:"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:192,columnNumber:25},this)," 50 tokens"]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:192,columnNumber:21},this),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"Meister:"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:193,columnNumber:25},this)," 30 tokens"]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:193,columnNumber:21},this),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"Seeker:"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:194,columnNumber:25},this)," 20 tokens"]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:194,columnNumber:21},this),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"Pathfinder:"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:195,columnNumber:25},this)," 20 tokens"]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:195,columnNumber:21},this),e.jsxDEV("li",{children:[e.jsxDEV("strong",{children:"Novice:"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:196,columnNumber:25},this)," 20 tokens"]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:196,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:191,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:189,columnNumber:17},this),e.jsxDEV("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxDEV("h3",{className:"font-medium mb-2",children:"Automatic Schedule"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:201,columnNumber:19},this),e.jsxDEV("ul",{className:"space-y-1 text-sm",children:[e.jsxDEV("li",{children:"• Runs on 1st day of month"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:203,columnNumber:21},this),e.jsxDEV("li",{children:"• Grants to active finders only"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:204,columnNumber:21},this),e.jsxDEV("li",{children:"• Tokens expire after 1 year"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:205,columnNumber:21},this),e.jsxDEV("li",{children:"• Prevents duplicate grants"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:206,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:202,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:200,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:188,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:180,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:179,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:172,columnNumber:9},this),e.jsxDEV(r,{children:[e.jsxDEV(m,{children:e.jsxDEV(o,{className:"flex items-center space-x-2",children:[e.jsxDEV(u,{className:"w-5 h-5"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:218,columnNumber:15},this),e.jsxDEV("span",{children:"Manual Token Grant"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:219,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:217,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:216,columnNumber:11},this),e.jsxDEV(c,{children:e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("p",{className:"text-gray-600",children:"Use this button to manually trigger the monthly token grant. This is useful for testing or if the automatic grant failed."},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:224,columnNumber:15},this),s&&e.jsxDEV(f,{variant:"destructive",children:[e.jsxDEV(C,{className:"h-4 w-4"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:230,columnNumber:19},this),e.jsxDEV(j,{children:"Monthly tokens have already been granted this month. Granting again will create duplicate tokens."},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:231,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:229,columnNumber:17},this),e.jsxDEV(P,{onClick:v,disabled:l.isPending||s,className:"w-full md:w-auto",size:"lg",children:l.isPending?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(S,{className:"w-4 h-4 mr-2 animate-spin"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:245,columnNumber:21},this),"Granting Tokens..."]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:244,columnNumber:19},this):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(u,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:250,columnNumber:21},this),"Grant Monthly Tokens"]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:249,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:237,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:223,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:222,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:215,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:120,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/450/Desktop/KK/AlajaClean/client/src/pages/admin/monthly-token-grant.tsx",lineNumber:117,columnNumber:5},this)}export{B as default};
