import{g as Q,h as ie,r as y,i as ce,k as R,j as e,l as P,B as k,R as de,C as c,b as d,T as xe,m as A,n as V,o as f,p as N,F as oe,e as v,S as L,q as E,s as q,t as _,v as i,I as B,D as me,W as G,w as p,x as U,y as H,z as he,G as ue}from"./index-IodkLc8O.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=Q("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=Q("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);function fe(){const{user:u}=ie(),[o,z]=y.useState("all"),[S,Y]=y.useState(""),[T,J]=y.useState(""),[C,X]=y.useState("all"),[w,Z]=y.useState("monthly"),F=ce(),{data:ee=[],isLoading:se,error:M}=R({queryKey:["/api/admin/transactions"],enabled:!!u&&u.role==="admin",retry:1,staleTime:5*60*1e3}),{data:j=[],isLoading:ae,error:I}=R({queryKey:["/api/admin/withdrawals"],enabled:!!u&&u.role==="admin",retry:1,staleTime:5*60*1e3}),{data:g=[],isLoading:te,error:$}=R({queryKey:["/api/admin/contracts"],enabled:!!u&&u.role==="admin",retry:1,staleTime:5*60*1e3}),h=se||ae||te,O=M||I||$,W=()=>{F.invalidateQueries({queryKey:["/api/admin/transactions"]}),F.invalidateQueries({queryKey:["/api/admin/withdrawals"]}),F.invalidateQueries({queryKey:["/api/admin/contracts"]})},x=ee.filter(s=>{const r=new Date(s.createdAt),n=new Date;if(o==="today"){const t=new Date;return t.setHours(0,0,0,0),r>=t}else if(o==="week"){const t=new Date(n.getTime()-6048e5);return r>=t}else if(o==="month"){const t=new Date(n.getTime()-2592e6);return r>=t}else if(o==="year"){const t=new Date(n.getTime()-31536e6);return r>=t}else if(o==="custom"&&S&&T){const t=new Date(S),l=new Date(T);return l.setHours(23,59,59,999),r>=t&&r<=l}return C!=="all"?s.type===C:!0}),b={totalRevenue:x.filter(s=>["findertoken_purchase","escrow_funding"].includes(s.type)).reduce((s,r)=>s+Math.abs(r.amount),0),totalWithdrawals:j.filter(s=>s.status==="approved").reduce((s,r)=>s+parseFloat(r.amount),0),pendingEscrow:g.filter(s=>s.escrowStatus==="held").reduce((s,r)=>s+parseFloat(r.amount),0),tokenSales:x.filter(s=>s.type==="findertoken_purchase").reduce((s,r)=>s+Math.abs(r.amount),0)},re=(s=>{const r=x.filter(n=>["findertoken_purchase","escrow_funding"].includes(n.type)).reduce((n,t)=>{const l=new Date(t.createdAt);let a;switch(s){case"daily":a=l.toISOString().split("T")[0];break;case"weekly":const K=new Date(l);K.setDate(l.getDate()-l.getDay()),a=`Week of ${K.toISOString().split("T")[0]}`;break;case"monthly":a=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;break;case"yearly":a=l.getFullYear().toString();break;default:a=l.toISOString().split("T")[0]}return n[a]||(n[a]=0),n[a]+=Math.abs(t.amount),n},{});return Object.entries(r).map(([n,t])=>({[s==="weekly"?"week":s==="monthly"?"month":s==="yearly"?"year":"date"]:n,amount:t})).sort((n,t)=>{const l=s==="weekly"?"week":s==="monthly"?"month":s==="yearly"?"year":"date";return n[l].localeCompare(t[l])})})(w),m=s=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(s).replace(/NGN/g,"â‚¦"),D=s=>new Date(s).toLocaleDateString("en-NG",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}),le=s=>{switch(s){case"findertoken_purchase":return e.jsx(A,{className:"w-4 h-4 text-green-600"});case"escrow_funding":return e.jsx(V,{className:"w-4 h-4 text-blue-600"});case"withdrawal":return e.jsx(je,{className:"w-4 h-4 text-red-600"});case"grant":return e.jsx(ue,{className:"w-4 h-4 text-purple-600"});default:return e.jsx(A,{className:"w-4 h-4 text-gray-600"})}},ne=()=>{const s=x.map(a=>({Date:D(a.createdAt),Type:a.type,Amount:a.amount,Description:a.description,User:a.user?`${a.user.firstName} ${a.user.lastName}`:a.finder?`${a.finder.user.firstName} ${a.finder.user.lastName}`:"N/A",Reference:a.reference||"N/A"})),r=[Object.keys(s[0]).join(","),...s.map(a=>Object.values(a).join(","))].join(`
`),n=new Blob([r],{type:"text/csv"}),t=window.URL.createObjectURL(n),l=document.createElement("a");l.href=t,l.download=`financial-statement-${o}-${new Date().toISOString().split("T")[0]}.csv`,l.click()};return h?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(P,{currentPage:"financial"}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-finder-red mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading financial data..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(P,{currentPage:"financial"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Financial Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Comprehensive financial overview and accounting statements"})]}),e.jsxs(k,{onClick:W,variant:"outline",size:"sm",className:"flex items-center space-x-2",disabled:h,children:[h?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:h?"Refreshing...":"Refresh Data"})]})]}),O&&e.jsx("div",{className:"mb-8",children:e.jsx(c,{className:"border-red-200 bg-red-50",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-bold",children:"!"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading Financial Data"}),e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:[M&&"Failed to load transactions. ",I&&"Failed to load withdrawals. ",$&&"Failed to load contracts. ","Please try refreshing the page or contact support if the issue persists."]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsx(k,{onClick:W,className:"bg-red-600 hover:bg-red-700 text-white",size:"sm",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-2"}),"Retrying..."]}):"Retry Loading"}),e.jsx(k,{onClick:()=>window.location.reload(),className:"bg-gray-600 hover:bg-gray-700 text-white",size:"sm",children:"Refresh Page"})]})]})]})})})}),!h&&!O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m(b.totalRevenue)})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(xe,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Token Sales"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:m(b.tokenSales)})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(A,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Escrow"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:m(b.pendingEscrow)})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(V,{className:"w-6 h-6 text-orange-600"})})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Withdrawals"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m(b.totalWithdrawals)})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(ge,{className:"w-6 h-6 text-red-600"})})]})})})]}),e.jsxs(c,{className:"mb-6",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Filters & Controls"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Date Range"}),e.jsxs(L,{value:o,onValueChange:z,children:[e.jsx(E,{children:e.jsx(q,{})}),e.jsxs(_,{children:[e.jsx(i,{value:"all",children:"All Time"}),e.jsx(i,{value:"today",children:"Today"}),e.jsx(i,{value:"week",children:"Last 7 Days"}),e.jsx(i,{value:"month",children:"Last 30 Days"}),e.jsx(i,{value:"year",children:"Last Year"}),e.jsx(i,{value:"custom",children:"Custom Range"})]})]})]}),o==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(v,{children:"Start Date"}),e.jsx(B,{type:"date",value:S,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(v,{children:"End Date"}),e.jsx(B,{type:"date",value:T,onChange:s=>J(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Transaction Type"}),e.jsxs(L,{value:C,onValueChange:X,children:[e.jsx(E,{children:e.jsx(q,{})}),e.jsxs(_,{children:[e.jsx(i,{value:"all",children:"All Types"}),e.jsx(i,{value:"findertoken_purchase",children:"Token Purchases"}),e.jsx(i,{value:"escrow_funding",children:"Escrow Funding"}),e.jsx(i,{value:"withdrawal",children:"Withdrawals"}),e.jsx(i,{value:"grant",children:"Token Grants"})]})]})]}),e.jsxs("div",{children:[e.jsx(v,{children:"View Mode"}),e.jsxs(L,{value:w,onValueChange:s=>Z(s),children:[e.jsx(E,{children:e.jsx(q,{})}),e.jsxs(_,{children:[e.jsx(i,{value:"daily",children:"Daily"}),e.jsx(i,{value:"weekly",children:"Weekly"}),e.jsx(i,{value:"monthly",children:"Monthly"}),e.jsx(i,{value:"yearly",children:"Yearly"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(k,{onClick:ne,className:"flex items-center space-x-2",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"Export CSV"})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs(c,{className:"h-fit",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{children:"Withdrawal Requests"}),e.jsx(p,{variant:"outline",className:"ml-auto",children:j.length})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No withdrawal requests found"})]}):j.slice(0,10).map(s=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:[s.finder.user.firstName," ",s.finder.user.lastName]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.finder.user.email})]}),e.jsx(p,{variant:s.status==="approved"?"default":s.status==="pending"?"secondary":s.status==="processing"?"outline":"destructive",className:"text-xs",children:s.status})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-red-600",children:m(parseFloat(s.amount))}),e.jsx("span",{className:"text-xs text-gray-500",children:D(s.requestedAt)})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["via ",s.paymentMethod]})]},s.id)),j.length>10&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing first 10 of ",j.length," requests"]})})]})})]}),e.jsxs(c,{className:"h-fit",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{children:"Contract Funding"}),e.jsx(p,{variant:"outline",className:"ml-auto",children:g.length})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No contracts found"})]}):g.slice(0,10).map(s=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-sm",children:["Client: ",s.client.firstName," ",s.client.lastName]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Finder: ",s.finder.user.firstName," ",s.finder.user.lastName]})]}),e.jsx(p,{variant:s.escrowStatus==="completed"?"default":s.escrowStatus==="held"?"secondary":s.escrowStatus==="released"?"outline":"destructive",className:"text-xs",children:s.escrowStatus})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-bold text-blue-600",children:m(parseFloat(s.amount))}),e.jsx("span",{className:"text-xs text-gray-500",children:D(s.createdAt)})]})]},s.id)),g.length>10&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing first 10 of ",g.length," contracts"]})})]})})]}),e.jsxs(c,{className:"h-fit",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Recent Transactions"}),e.jsx(p,{variant:"outline",className:"ml-auto",children:x.length})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[x.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No transactions found"})]}):x.slice(0,10).map(s=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[le(s.type),e.jsx(p,{variant:s.type==="findertoken_purchase"?"default":s.type==="escrow_funding"?"secondary":s.type==="withdrawal"?"destructive":"outline",className:"text-xs",children:s.type.replace("_"," ")})]}),e.jsx("span",{className:"text-xs text-gray-500",children:D(s.createdAt)})]}),e.jsx("div",{className:"mb-2",children:s.user?e.jsxs("p",{className:"font-medium text-sm",children:[s.user.firstName," ",s.user.lastName]}):s.finder?e.jsxs("p",{className:"font-medium text-sm",children:[s.finder.user.firstName," ",s.finder.user.lastName]}):e.jsx("p",{className:"text-sm text-gray-400",children:"N/A"})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate flex-1 mr-2",children:s.description}),e.jsxs("span",{className:`text-sm font-bold ${s.amount>0?"text-green-600":"text-red-600"}`,children:[s.amount>0?"+":"",m(Math.abs(s.amount))]})]})]},s.id)),x.length>10&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing first 10 of ",x.length," transactions"]})})]})})]})]}),e.jsxs(c,{className:"mb-6",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsxs("span",{children:["Revenue by ",w.charAt(0).toUpperCase()+w.slice(1)]})]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:re.map((s,r)=>{const n=Object.keys(s)[0],t=s[n],l=s.amount;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:t}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:m(l)})]},r)})})})]})]})]})]})}export{fe as default};
