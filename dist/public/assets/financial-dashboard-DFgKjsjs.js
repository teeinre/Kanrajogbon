import{g as G,h as ie,r as p,i as de,k,j as e,l as q,B as w,R as ce,C as d,b as c,m as S,n as C,F as oe,e as y,S as F,o as R,p as A,q as E,s as i,I as H,D as xe,T as me,t as L,v as P,w as he,f as ue,x as B,y as je,z as ge,G as U,H as j,J as pe,K as g,M as ye}from"./index-RmCNAPmE.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=G("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=G("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);function be(){const{user:h}=ie(),[o,W]=p.useState("all"),[v,Q]=p.useState(""),[b,z]=p.useState(""),[D,Y]=p.useState("all"),[f,J]=p.useState("monthly"),T=de(),{data:X=[],isLoading:Z,error:_}=k({queryKey:["/api/admin/transactions"],enabled:!!h&&h.role==="admin",retry:1,staleTime:5*60*1e3}),{data:ee=[],isLoading:se,error:M}=k({queryKey:["/api/admin/withdrawals"],enabled:!!h&&h.role==="admin",retry:1,staleTime:5*60*1e3}),{data:ae=[],isLoading:te,error:I}=k({queryKey:["/api/admin/contracts"],enabled:!!h&&h.role==="admin",retry:1,staleTime:5*60*1e3}),x=Z||se||te,K=_||M||I,O=()=>{T.invalidateQueries({queryKey:["/api/admin/transactions"]}),T.invalidateQueries({queryKey:["/api/admin/withdrawals"]}),T.invalidateQueries({queryKey:["/api/admin/contracts"]})},m=X.filter(s=>{const r=new Date(s.createdAt),n=new Date;if(o==="today"){const t=new Date;return t.setHours(0,0,0,0),r>=t}else if(o==="week"){const t=new Date(n.getTime()-6048e5);return r>=t}else if(o==="month"){const t=new Date(n.getTime()-2592e6);return r>=t}else if(o==="year"){const t=new Date(n.getTime()-31536e6);return r>=t}else if(o==="custom"&&v&&b){const t=new Date(v),l=new Date(b);return l.setHours(23,59,59,999),r>=t&&r<=l}return D!=="all"?s.type===D:!0}),N={totalRevenue:m.filter(s=>["findertoken_purchase","escrow_funding"].includes(s.type)).reduce((s,r)=>s+Math.abs(r.amount),0),totalWithdrawals:ee.filter(s=>s.status==="approved").reduce((s,r)=>s+parseFloat(r.amount),0),pendingEscrow:ae.filter(s=>s.escrowStatus==="held").reduce((s,r)=>s+parseFloat(r.amount),0),tokenSales:m.filter(s=>s.type==="findertoken_purchase").reduce((s,r)=>s+Math.abs(r.amount),0)},re=(s=>{const r=m.filter(n=>["findertoken_purchase","escrow_funding"].includes(n.type)).reduce((n,t)=>{const l=new Date(t.createdAt);let a;switch(s){case"daily":a=l.toISOString().split("T")[0];break;case"weekly":const $=new Date(l);$.setDate(l.getDate()-l.getDay()),a=`Week of ${$.toISOString().split("T")[0]}`;break;case"monthly":a=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`;break;case"yearly":a=l.getFullYear().toString();break;default:a=l.toISOString().split("T")[0]}return n[a]||(n[a]=0),n[a]+=Math.abs(t.amount),n},{});return Object.entries(r).map(([n,t])=>({[s==="weekly"?"week":s==="monthly"?"month":s==="yearly"?"year":"date"]:n,amount:t})).sort((n,t)=>{const l=s==="weekly"?"week":s==="monthly"?"month":s==="yearly"?"year":"date";return n[l].localeCompare(t[l])})})(f),u=s=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(s).replace(/NGN/g,"â‚¦"),V=s=>new Date(s).toLocaleDateString("en-NG",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}),le=s=>{switch(s){case"findertoken_purchase":return e.jsx(L,{className:"w-4 h-4 text-green-600"});case"escrow_funding":return e.jsx(P,{className:"w-4 h-4 text-blue-600"});case"withdrawal":return e.jsx(fe,{className:"w-4 h-4 text-red-600"});case"grant":return e.jsx(ye,{className:"w-4 h-4 text-purple-600"});default:return e.jsx(L,{className:"w-4 h-4 text-gray-600"})}},ne=()=>{const s=m.map(a=>({Date:V(a.createdAt),Type:a.type,Amount:a.amount,Description:a.description,User:a.user?`${a.user.firstName} ${a.user.lastName}`:a.finder?`${a.finder.user.firstName} ${a.finder.user.lastName}`:"N/A",Reference:a.reference||"N/A"})),r=[Object.keys(s[0]).join(","),...s.map(a=>Object.values(a).join(","))].join(`
`),n=new Blob([r],{type:"text/csv"}),t=window.URL.createObjectURL(n),l=document.createElement("a");l.href=t,l.download=`financial-statement-${o}-${new Date().toISOString().split("T")[0]}.csv`,l.click()};return x?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(q,{currentPage:"financial"}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-finder-red mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading financial data..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(q,{currentPage:"financial"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"mb-8 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Financial Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Comprehensive financial overview and accounting statements"})]}),e.jsxs(w,{onClick:O,variant:"outline",size:"sm",className:"flex items-center space-x-2",disabled:x,children:[x?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:x?"Refreshing...":"Refresh Data"})]})]}),x&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(s=>e.jsx(d,{className:"animate-pulse",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32"})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"})]})})},s))}),e.jsx(d,{className:"animate-pulse",children:e.jsx(c,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]},s))})})}),e.jsx(d,{className:"animate-pulse",children:e.jsxs(c,{className:"p-6",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},s))})]})})]}),K&&e.jsx("div",{className:"mb-8",children:e.jsx(d,{className:"border-red-200 bg-red-50",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-bold",children:"!"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading Financial Data"}),e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:[_&&"Failed to load transactions. ",M&&"Failed to load withdrawals. ",I&&"Failed to load contracts. ","Please try refreshing the page or contact support if the issue persists."]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsx(w,{onClick:O,className:"bg-red-600 hover:bg-red-700 text-white",size:"sm",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white mr-2"}),"Retrying..."]}):"Retry Loading"}),e.jsx(w,{onClick:()=>window.location.reload(),className:"bg-gray-600 hover:bg-gray-700 text-white",size:"sm",children:"Refresh Page"})]})]})]})})})}),!x&&!K&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{className:"mb-6",children:[e.jsx(S,{children:e.jsxs(C,{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Filters & Controls"})]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Date Range"}),e.jsxs(F,{value:o,onValueChange:W,children:[e.jsx(R,{children:e.jsx(A,{})}),e.jsxs(E,{children:[e.jsx(i,{value:"all",children:"All Time"}),e.jsx(i,{value:"today",children:"Today"}),e.jsx(i,{value:"week",children:"Last 7 Days"}),e.jsx(i,{value:"month",children:"Last 30 Days"}),e.jsx(i,{value:"year",children:"Last Year"}),e.jsx(i,{value:"custom",children:"Custom Range"})]})]})]}),o==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(y,{children:"Start Date"}),e.jsx(H,{type:"date",value:v,onChange:s=>Q(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(y,{children:"End Date"}),e.jsx(H,{type:"date",value:b,onChange:s=>z(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(y,{children:"Transaction Type"}),e.jsxs(F,{value:D,onValueChange:Y,children:[e.jsx(R,{children:e.jsx(A,{})}),e.jsxs(E,{children:[e.jsx(i,{value:"all",children:"All Types"}),e.jsx(i,{value:"findertoken_purchase",children:"Token Purchases"}),e.jsx(i,{value:"escrow_funding",children:"Escrow Funding"}),e.jsx(i,{value:"withdrawal",children:"Withdrawals"}),e.jsx(i,{value:"grant",children:"Token Grants"})]})]})]}),e.jsxs("div",{children:[e.jsx(y,{children:"View Mode"}),e.jsxs(F,{value:f,onValueChange:s=>J(s),children:[e.jsx(R,{children:e.jsx(A,{})}),e.jsxs(E,{children:[e.jsx(i,{value:"daily",children:"Daily"}),e.jsx(i,{value:"weekly",children:"Weekly"}),e.jsx(i,{value:"monthly",children:"Monthly"}),e.jsx(i,{value:"yearly",children:"Yearly"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(w,{onClick:ne,className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:"Export CSV"})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6",children:[e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:u(N.totalRevenue)})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(me,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Token Sales"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:u(N.tokenSales)})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(L,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Escrow"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:u(N.pendingEscrow)})]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(P,{className:"w-6 h-6 text-orange-600"})})]})})}),e.jsx(d,{children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Withdrawals"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:u(N.totalWithdrawals)})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(Ne,{className:"w-6 h-6 text-red-600"})})]})})})]}),e.jsxs(d,{className:"mb-6",children:[e.jsx(S,{children:e.jsxs(C,{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsxs("span",{children:["Revenue by ",f.charAt(0).toUpperCase()+f.slice(1)]})]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:re.map((s,r)=>{const n=Object.keys(s)[0],t=s[n],l=s.amount;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:t}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:u(l)})]},r)})})})]}),e.jsxs(d,{children:[e.jsx(S,{children:e.jsxs(C,{className:"flex items-center space-x-2",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:"Transaction Details"}),e.jsxs(B,{variant:"outline",children:[m.length," transactions"]})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(je,{children:[e.jsx(ge,{children:e.jsxs(U,{children:[e.jsx(j,{children:"Date & Time"}),e.jsx(j,{children:"Type"}),e.jsx(j,{children:"User"}),e.jsx(j,{children:"Description"}),e.jsx(j,{className:"text-right",children:"Amount"}),e.jsx(j,{children:"Reference"})]})}),e.jsx(pe,{children:m.slice(0,50).map(s=>e.jsxs(U,{children:[e.jsx(g,{className:"font-mono text-sm",children:V(s.createdAt)}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[le(s.type),e.jsx(B,{variant:s.type==="findertoken_purchase"?"default":s.type==="escrow_funding"?"secondary":s.type==="withdrawal"?"destructive":"outline",children:s.type.replace("_"," ")})]})}),e.jsx(g,{children:s.user?e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.user.firstName," ",s.user.lastName]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.user.email})]}):s.finder?e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.finder.user.firstName," ",s.finder.user.lastName]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.finder.user.email})]}):e.jsx("span",{className:"text-gray-400",children:"N/A"})}),e.jsx(g,{className:"max-w-md truncate",children:s.description}),e.jsx(g,{className:"text-right font-mono",children:e.jsxs("span",{className:s.amount>0?"text-green-600":"text-red-600",children:[s.amount>0?"+":"",u(Math.abs(s.amount))]})}),e.jsx(g,{className:"font-mono text-sm",children:s.reference||"-"})]},s.id))})]})}),m.length>50&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Showing first 50 transactions. Export CSV for complete data."})})]})]})]})]})]})}export{be as default};
