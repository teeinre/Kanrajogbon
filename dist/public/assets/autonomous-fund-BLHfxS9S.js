import{g as M,h as H,a as R,i as J,k as B,r as b,H as w,j as e,l as v,C as x,o as p,p as g,Q as C,b as j,J as I,U,M as L,N as q,O as D,e as m,I as f,V as O,B as P,P as E,c as $,X as z,m as Q}from"./index-4GW1ed5-.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=M("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function X(){const{user:y,getToken:l,refreshAuthToken:N}=H(),{toast:c}=R(),k=J(),{data:n,isLoading:A}=B({queryKey:["/api/admin/autonomous-fund/config"],enabled:!!y&&y.role==="admin"}),[i,o]=b.useState({holdingPeriodHours:24,autoCreditEnabled:!0,minimumRating:4,minimumJobsCompleted:1});b.useEffect(()=>{n&&o(n)},[n]);const u=w({mutationFn:async s=>{let a=l();if(!a)throw new Error("No authentication token found");const t=await fetch("/api/admin/autonomous-fund/config",{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(t.status===401)if(await N()){a=l();const d=await fetch("/api/admin/autonomous-fund/config",{method:"PUT",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!d.ok){const T=await d.json();throw new Error(T.message||"Failed to update configuration after refresh")}return d.json()}else throw new Error("Authentication failed. Please log in again.");if(!t.ok){const r=await t.json();throw new Error(r.message||"Failed to update configuration")}return t.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/admin/autonomous-fund/config"]}),c({title:"Success",description:"Configuration updated successfully!"})},onError:s=>{c({title:"Error",description:s.message||"Failed to update configuration",variant:"destructive"})}}),h=w({mutationFn:async()=>{let s=l();if(!s)throw new Error("No authentication token found");const a=await fetch("/api/admin/autonomous-fund/process",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(a.status===401)if(await N()){s=l();const r=await fetch("/api/admin/autonomous-fund/process",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!r.ok){const d=await r.json();throw new Error(d.message||"Failed to process autonomous fund after refresh")}return r.json()}else throw new Error("Authentication failed. Please log in again.");if(!a.ok){const t=await a.json();throw new Error(t.message||"Failed to process funds")}return a.json()},onSuccess:()=>{c({title:"Success",description:"Autonomous fund processing initiated!"})},onError:s=>{c({title:"Error",description:s.message||"Failed to process funds",variant:"destructive"})}}),F=()=>{u.mutate(i)},S=()=>{window.confirm("Are you sure you want to manually process autonomous fund crediting?")&&h.mutate()};return A?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(v,{currentPage:"autonomous-fund"}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-finder-red mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading configuration..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(v,{currentPage:"autonomous-fund"}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Autonomous Fund Service"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configure automatic fund crediting and level management"})]}),e.jsxs(x,{className:"mb-6",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx("span",{children:"Service Status"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${n!=null&&n.autoCreditEnabled?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Auto-Credit"}),e.jsx("p",{className:"text-sm text-gray-600",children:n!=null&&n.autoCreditEnabled?"Enabled":"Disabled"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx(I,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Holding Period"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n==null?void 0:n.holdingPeriodHours," hours"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Minimum Rating"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n==null?void 0:n.minimumRating,"/5.0"]})]})]})]})})]}),e.jsxs(x,{className:"mb-6",children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx("span",{children:"Configuration Settings"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(L,{children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx(D,{children:"This system automatically credits funds to finders after the holding period and updates their levels based on performance metrics."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"holdingPeriod",children:"Holding Period (Hours)"}),e.jsx(f,{id:"holdingPeriod",type:"number",min:"1",max:"168",value:i.holdingPeriodHours,onChange:s=>o(a=>({...a,holdingPeriodHours:parseInt(s.target.value)||24}))}),e.jsx("p",{className:"text-sm text-gray-600",children:"Hours to hold funds before automatic crediting"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"minimumRating",children:"Minimum Rating"}),e.jsx(f,{id:"minimumRating",type:"number",min:"1",max:"5",step:"0.1",value:i.minimumRating,onChange:s=>o(a=>({...a,minimumRating:parseFloat(s.target.value)||4}))}),e.jsx("p",{className:"text-sm text-gray-600",children:"Minimum rating required for level advancement"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"minimumJobs",children:"Minimum Jobs Completed"}),e.jsx(f,{id:"minimumJobs",type:"number",min:"0",value:i.minimumJobsCompleted,onChange:s=>o(a=>({...a,minimumJobsCompleted:parseInt(s.target.value)||1}))}),e.jsx("p",{className:"text-sm text-gray-600",children:"Minimum jobs required for level advancement"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"autoCredit",children:"Enable Auto-Credit"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"autoCredit",checked:i.autoCreditEnabled,onCheckedChange:s=>o(a=>({...a,autoCreditEnabled:s}))}),e.jsx("span",{className:"text-sm text-gray-600",children:i.autoCreditEnabled?"Enabled":"Disabled"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Automatically credit funds after holding period"})]})]}),e.jsx(P,{onClick:F,disabled:u.isPending,className:"w-full md:w-auto",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Update Configuration"]})})]})})]}),e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:"Manual Processing"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Manually trigger autonomous fund processing. This will check all completed contracts and credit eligible funds."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(K,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"How it works:"}),e.jsxs("ul",{className:"text-sm text-blue-800 mt-1 space-y-1",children:[e.jsx("li",{children:"• Checks contracts completed within holding period"}),e.jsx("li",{children:"• Credits funds to finder available balance"}),e.jsx("li",{children:"• Updates finder level based on performance"}),e.jsx("li",{children:"• Runs automatically every hour when enabled"})]})]})]})}),e.jsx(P,{onClick:S,disabled:h.isPending||!i.autoCreditEnabled,variant:"outline",className:"w-full md:w-auto",children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Process Now"]})})]})})]})]})]})}export{X as default};
