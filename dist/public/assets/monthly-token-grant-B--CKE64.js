import{h as G,a as A,i as P,k as D,H as S,j as e,l as y,C as l,o,p as c,z as p,b as d,c as E,J as F,w as f,K as h,M as N,N as k,O as w,B,P as L}from"./index-BzVmYWmQ.js";function O(){const{user:m,getToken:x,refreshAuthToken:v}=G(),{toast:j}=A(),b=P(),{data:a,isLoading:T}=D({queryKey:["/api/admin/monthly-token-grant/status"],enabled:!!m&&m.role==="admin"}),r=S({mutationFn:async()=>{let n=x();if(!n)throw new Error("No authentication token found");const t=await fetch("/api/admin/monthly-token-grant",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(t.status===401)if(await v()){n=x();const i=await fetch("/api/admin/monthly-token-grant",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!i.ok){const M=await i.json();throw new Error(M.message||"Failed to grant tokens after refresh")}return i.json()}else throw new Error("Authentication failed. Please log in again.");if(!t.ok){const g=await t.json();throw new Error(g.message||"Failed to grant tokens")}return t.json()},onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/monthly-token-grant/status"]}),j({title:"Success",description:"Monthly tokens granted successfully!"})},onError:n=>{j({title:"Error",description:n.message||"Failed to grant monthly tokens",variant:"destructive"})}}),C=()=>{window.confirm("Are you sure you want to grant monthly tokens to all active finders? This action cannot be undone.")&&r.mutate()},u=new Date().getDate()===1,s=(a==null?void 0:a.hasGrantedThisMonth)||!1;return T?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(y,{currentPage:"monthly-tokens"}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-finder-red mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-4",children:"Loading monthly token status..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(y,{currentPage:"monthly-tokens"}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Monthly Token Grant"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage automatic monthly token distribution to finders"})]}),e.jsxs(l,{className:"mb-6",children:[e.jsx(o,{children:e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{children:"Current Status"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s?e.jsx(E,{className:"w-5 h-5 text-green-600"}):e.jsx(F,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Monthly Token Grant Status"}),e.jsx("p",{className:"text-sm text-gray-600",children:s?"Tokens have been granted this month":"Tokens not yet granted this month"})]})]}),e.jsx(f,{variant:s?"default":"secondary",children:s?"Granted":"Pending"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(p,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Current Date"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString()})]})]}),e.jsx(f,{variant:u?"default":"outline",children:u?"1st Day":"Not 1st Day"})]})]})})]}),e.jsxs(l,{className:"mb-6",children:[e.jsx(o,{children:e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{children:"Token Grant Details"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(N,{children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(w,{children:"This system automatically grants tokens to all active finders based on their level on the 1st day of each month."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Monthly Token Amounts by Level"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"GrandMeister:"})," 50 tokens"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Meister:"})," 30 tokens"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Seeker:"})," 20 tokens"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pathfinder:"})," 20 tokens"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Novice:"})," 20 tokens"]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Automatic Schedule"}),e.jsxs("ul",{className:"space-y-1 text-sm",children:[e.jsx("li",{children:"• Runs on 1st day of month"}),e.jsx("li",{children:"• Grants to active finders only"}),e.jsx("li",{children:"• Tokens expire after 1 year"}),e.jsx("li",{children:"• Prevents duplicate grants"})]})]})]})]})})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{children:"Manual Token Grant"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Use this button to manually trigger the monthly token grant. This is useful for testing or if the automatic grant failed."}),s&&e.jsxs(N,{variant:"destructive",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(w,{children:"Monthly tokens have already been granted this month. Granting again will create duplicate tokens."})]}),e.jsx(B,{onClick:C,disabled:r.isPending||s,className:"w-full md:w-auto",size:"lg",children:r.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}),"Granting Tokens..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Grant Monthly Tokens"]})})]})})]})]})]})}export{O as default};
